{% if site.footer_scripts %}
  {% for script in site.footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% else %}
  <script src="{{ '/assets/js/main.min.js' | relative_url }}"></script>
{% endif %}

{% if site.search == true or page.layout == "search" %}
  {%- assign search_provider = site.search_provider | default: "lunr" -%}
  {%- case search_provider -%}
    {%- when "lunr" -%}
      {% include_cached search/lunr-search-scripts.html %}
    {%- when "google" -%}
      {% include_cached search/google-search-scripts.html %}
    {%- when "algolia" -%}
      {% include_cached search/algolia-search-scripts.html %}
  {%- endcase -%}
{% endif %}

{% include analytics.html %}
{% include /comments-providers/scripts.html %}

{% if site.after_footer_scripts %}
  {% for script in site.after_footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% endif %}

{% if page.use_math %}
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/javascript">
  // GitHub Pages에서도 MathJax가 확실하게 작동하도록 보장
  (function() {
    function typesetMath() {
      if (typeof MathJax !== 'undefined' && MathJax.Hub) {
        console.log("MathJax found, typesetting...");
        console.log("MathJax config:", MathJax.Hub.config);
        
        // 수식이 있는지 확인 - 모든 가능한 형식 확인
        var allScripts = document.querySelectorAll('script');
        var mathScripts = [];
        allScripts.forEach(function(script) {
          var type = script.getAttribute('type');
          if (type && (type.indexOf('math/tex') !== -1 || type.indexOf('mathjax') !== -1)) {
            mathScripts.push(script);
          }
        });
        
        console.log("Total scripts:", allScripts.length);
        console.log("Found math scripts:", mathScripts.length);
        
        if (mathScripts.length > 0) {
          console.log("First math script type:", mathScripts[0].getAttribute('type'));
          console.log("First math script content:", mathScripts[0].textContent.substring(0, 100));
          console.log("First math script parent:", mathScripts[0].parentElement.tagName);
        }
        
        // MathJax 설정 확인
        console.log("MathJax skipTags:", MathJax.Hub.config.tex2jax.skipTags);
        console.log("MathJax displayMath:", MathJax.Hub.config.tex2jax.displayMath);
        
        // 모든 script 태그의 type 확인
        var scriptTypes = [];
        allScripts.forEach(function(script) {
          var type = script.getAttribute('type');
          if (type && type.indexOf('math') !== -1) {
            scriptTypes.push(type);
          }
        });
        console.log("All math-related script types:", scriptTypes);
        
        MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        return true;
      }
      return false;
    }
    
    // 즉시 시도
    if (!typesetMath()) {
      // DOM이 준비되면 시도
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(function() {
            if (!typesetMath()) {
              // 페이지 로드 완료 후 재시도
              window.addEventListener("load", function() {
                setTimeout(typesetMath, 1000);
              });
            }
          }, 500);
        });
      } else {
        // 이미 로드된 경우
        window.addEventListener("load", function() {
          setTimeout(function() {
            if (!typesetMath()) {
              // 최대 5초까지 재시도
              var retries = 0;
              var maxRetries = 25;
              var checkInterval = setInterval(function() {
                retries++;
                if (typesetMath() || retries >= maxRetries) {
                  clearInterval(checkInterval);
                }
              }, 200);
            }
          }, 1000);
        });
      }
    }
  })();
</script>
{% endif %}

