{% if site.footer_scripts %}
  {% for script in site.footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% else %}
  <script src="{{ '/assets/js/main.min.js' | relative_url }}"></script>
{% endif %}

{% if site.search == true or page.layout == "search" %}
  {%- assign search_provider = site.search_provider | default: "lunr" -%}
  {%- case search_provider -%}
    {%- when "lunr" -%}
      {% include_cached search/lunr-search-scripts.html %}
    {%- when "google" -%}
      {% include_cached search/google-search-scripts.html %}
    {%- when "algolia" -%}
      {% include_cached search/algolia-search-scripts.html %}
  {%- endcase -%}
{% endif %}

{% include analytics.html %}
{% include /comments-providers/scripts.html %}

{% if site.after_footer_scripts %}
  {% for script in site.after_footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% endif %}

{% if page.use_math %}
<script type="text/javascript">
  // GitHub Pages에서도 MathJax가 확실하게 작동하도록 body 끝에서 로드
  (function() {
    // MathJax 설정이 이미 head에 있으므로, 여기서는 스크립트만 로드
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.src = 'https://cdn.jsdelivr.net/npm/mathjax@2.7.7/MathJax.js?config=TeX-MML-AM_CHTML';
    script.onload = function() {
      if (typeof MathJax !== 'undefined' && MathJax.Hub) {
        MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
      }
    };
    script.onerror = function() {
      // 첫 번째 CDN 실패 시 대체 CDN 시도
      var fallbackScript = document.createElement('script');
      fallbackScript.type = 'text/javascript';
      fallbackScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML';
      fallbackScript.onload = function() {
        if (typeof MathJax !== 'undefined' && MathJax.Hub) {
          MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
      };
      document.head.appendChild(fallbackScript);
    };
    document.head.appendChild(script);
  })();
</script>
{% endif %}

