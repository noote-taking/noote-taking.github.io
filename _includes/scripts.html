{% if site.footer_scripts %}
  {% for script in site.footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% else %}
  <script src="{{ '/assets/js/main.min.js' | relative_url }}"></script>
{% endif %}

{% if site.search == true or page.layout == "search" %}
  {%- assign search_provider = site.search_provider | default: "lunr" -%}
  {%- case search_provider -%}
    {%- when "lunr" -%}
      {% include_cached search/lunr-search-scripts.html %}
    {%- when "google" -%}
      {% include_cached search/google-search-scripts.html %}
    {%- when "algolia" -%}
      {% include_cached search/algolia-search-scripts.html %}
  {%- endcase -%}
{% endif %}

{% include analytics.html %}
{% include /comments-providers/scripts.html %}

{% if site.after_footer_scripts %}
  {% for script in site.after_footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% endif %}

{% if page.use_math %}
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/javascript">
  // GitHub Pages에서도 MathJax가 확실하게 작동하도록 보장
  if (typeof MathJax !== 'undefined' && MathJax.Hub) {
    MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
  } else {
    // MathJax가 로드될 때까지 대기
    window.addEventListener("load", function() {
      var retries = 0;
      var maxRetries = 50;
      var checkInterval = setInterval(function() {
        retries++;
        if (typeof MathJax !== 'undefined' && MathJax.Hub && MathJax.Hub.queue) {
          MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
          clearInterval(checkInterval);
        } else if (retries >= maxRetries) {
          clearInterval(checkInterval);
          console.error("MathJax failed to load after 10 seconds");
        }
      }, 200);
    });
  }
</script>
{% endif %}

