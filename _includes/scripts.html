{% if site.footer_scripts %}
  {% for script in site.footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% else %}
  <script src="{{ '/assets/js/main.min.js' | relative_url }}"></script>
{% endif %}

{% if site.search == true or page.layout == "search" %}
  {%- assign search_provider = site.search_provider | default: "lunr" -%}
  {%- case search_provider -%}
    {%- when "lunr" -%}
      {% include_cached search/lunr-search-scripts.html %}
    {%- when "google" -%}
      {% include_cached search/google-search-scripts.html %}
    {%- when "algolia" -%}
      {% include_cached search/algolia-search-scripts.html %}
  {%- endcase -%}
{% endif %}

{% include analytics.html %}
{% include /comments-providers/scripts.html %}

{% if site.after_footer_scripts %}
  {% for script in site.after_footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% endif %}

{% if page.use_math %}
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/javascript">
  // GitHub Pages에서도 MathJax가 확실하게 작동하도록 보장
  (function() {
    function typesetMath() {
      if (typeof MathJax !== 'undefined' && MathJax.Hub) {
        console.log("MathJax found, typesetting...");
        console.log("MathJax config:", MathJax.Hub.config);
        
        // 수식이 있는지 확인
        var mathScripts = document.querySelectorAll('script[type="math/tex"], script[type="math/tex; mode=display"]');
        var textWithMath = document.body.innerText.match(/\$\$[\s\S]*?\$\$/g);
        console.log("Found math scripts:", mathScripts.length);
        console.log("Found $$ blocks in text:", textWithMath ? textWithMath.length : 0);
        
        MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        return true;
      }
      return false;
    }
    
    // 즉시 시도
    if (!typesetMath()) {
      // DOM이 준비되면 시도
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(function() {
            if (!typesetMath()) {
              // 페이지 로드 완료 후 재시도
              window.addEventListener("load", function() {
                setTimeout(typesetMath, 1000);
              });
            }
          }, 500);
        });
      } else {
        // 이미 로드된 경우
        window.addEventListener("load", function() {
          setTimeout(function() {
            if (!typesetMath()) {
              // 최대 5초까지 재시도
              var retries = 0;
              var maxRetries = 25;
              var checkInterval = setInterval(function() {
                retries++;
                if (typesetMath() || retries >= maxRetries) {
                  clearInterval(checkInterval);
                }
              }, 200);
            }
          }, 1000);
        });
      }
    }
  })();
</script>
{% endif %}

