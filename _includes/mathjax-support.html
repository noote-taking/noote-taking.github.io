<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      tags: 'ams'
    },
    options: {
      skipHtmlTags: ['script', 'style', 'textarea', 'pre', 'code']
    }
  };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script type="text/javascript">
  // script type="math/tex" 태그를 일반 텍스트로 변환 (MathJax 3.x가 처리하도록)
  (function() {
    var converted = false;
    
    function convertMathScripts() {
      if (converted) return;
      
      var mathScripts = document.querySelectorAll('script[type="math/tex"], script[type="math/tex; mode=display"]');
      if (mathScripts.length === 0) return;
      
      console.log("Converting " + mathScripts.length + " math scripts to text");
      
      // 배열로 변환 (forEach 중 DOM 변경 시 문제 방지)
      var scriptsArray = Array.prototype.slice.call(mathScripts);
      
      scriptsArray.forEach(function(script) {
        if (!script.parentNode) return;
        
        var mathText = script.textContent || script.innerText;
        var scriptType = script.getAttribute('type') || '';
        var isDisplay = scriptType.indexOf('mode=display') !== -1;
        
        // 스크립트 태그를 span 요소로 교체
        var span = document.createElement('span');
        span.textContent = isDisplay ? '$$' + mathText + '$$' : '$' + mathText + '$';
        script.parentNode.replaceChild(span, script);
      });
      
      converted = true;
      
      // MathJax 3.x가 로드되어 있으면 재처리
      if (window.MathJax && window.MathJax.typesetPromise) {
        window.MathJax.typesetPromise();
      }
    }
    
    // MathJax 3.x가 로드된 후 변환
    function initConversion() {
      if (window.MathJax && window.MathJax.typesetPromise) {
        // MathJax가 이미 로드되어 있으면 즉시 변환
        convertMathScripts();
        window.MathJax.typesetPromise();
      } else {
        // MathJax가 로드될 때까지 대기
        window.addEventListener("load", function() {
          setTimeout(function() {
            convertMathScripts();
            if (window.MathJax && window.MathJax.typesetPromise) {
              window.MathJax.typesetPromise();
            }
          }, 100);
        });
      }
    }
    
    // DOM이 준비되면 초기화
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initConversion);
    } else {
      initConversion();
    }
  })();
</script>

